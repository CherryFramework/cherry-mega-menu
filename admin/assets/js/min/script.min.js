!function(e){"use strict";e.fn.megaMenu=function(t){var n=e("<div />");n.settings=e.extend({cols:6,menu_item_id:0,menu_item_title:"",menu_item_depth:0},t);var i=e(".popup-wrapper_"),a="id-"+n.settings.menu_item_id;if(0==e("#"+a).length){var o=i.data("ui-class");i.append('<div id="'+a+'" class="white-popup-block '+o+'"><div class="popup-content_"><div class="popup-loading_"></div></div></div>')}n.log=function(e){window.console&&console.log&&console.log(e),-1==e&&alert(cherry_mega_menu.nonce_check_failed)},n.init=function(){n.log(cherry_mega_menu.debug_launched+" "+n.settings.menu_item_id),e.magnificPopup.open({items:{src:"#"+a},type:"inline",callbacks:{open:function(){s()}}}),e(document).on("click",".cherry-mega-menu-save-settings",function(t){t.preventDefault(),c(e(this))}),e(document).on("change",".toggle_menu",function(t){t.preventDefault(),c(e(this))})};var c=function(t){var i=t.parents("form"),a=i.serialize();d(),e.post(ajaxurl,a,function(e){m(),n.log(e)})},s=function(){e.ajax({type:"POST",url:ajaxurl,data:{action:"cherry_mega_menu_get_popup",_wpnonce:cherry_mega_menu.nonce,menu_item_id:n.settings.menu_item_id,menu_item_title:n.settings.menu_item_title,menu_item_depth:n.settings.menu_item_depth,total_cols:n.settings.cols},cache:!1,beforeSend:function(){e("#"+a+" .popup-content_").html('<div class="popup-loading_"></div>')},complete:function(){e("#"+a+" .popup-content_").find(".popup-loading_").remove()},success:function(t){var i=t.content;e("#"+a+" .popup-content_").addClass("depth-"+n.settings.menu_item_depth).html(i).on("click.cherry_menu_tabs",".vertical-tabs_.vertical-tabs_width_small_ a",function(t){t.preventDefault();var n=e(this).parents(".popup-content_"),i=n.find(".mega-menu-tabs-content_");e(this).parent().addClass("active").siblings().removeClass("active"),i.find("#"+e(this).data("tab")).css("visibility","visible").siblings().css("visibility","hidden"),r()}),e("#"+a+" .popup-content_ .vertical-tabs_.vertical-tabs_width_small_active a:first").trigger("click.cherry_menu_tabs"),u(),r(),e("#"+a+" #cherry-menu-tab-mega_menu").length&&(l(),_())}})},u=function(){var t=0;e("#"+a+" .mega-menu-tabs-content-item_").each(function(){parseInt(e(this).outerHeight())>t&&(t=parseInt(e(this).outerHeight()))}),e("#"+a+" .mega-menu-tabs-content_").height(t)},r=function(){e('input[data-init-script="icon-picker"]').each(function(){e(this).iconpicker()})},d=function(){e(".popup-saving_").show()},m=function(){e(".popup-saving_").hide();var t=!1;t||(e(".popup-saved_").stop().fadeIn("fast"),t=setTimeout(function(){e(".popup-saved_").stop().fadeOut("fast")},1e3))},_=function(){{var t=e("#"+a).find("#widgets"),i=t.innerWidth();parseInt(i/n.settings.cols)}t.sortable({forcePlaceholderSize:!0,placeholder:"drop-area",start:function(t,n){e(".widget").removeClass("open"),n.item.data("start_pos",n.item.index())},stop:function(e,t){t.item.removeAttr("style");var n=t.item.data("start_pos");n!==t.item.index()&&t.item.trigger("on_drop")}}),e(".widget",t).each(function(){p(e(this))})},l=function(t){var t=e("#"+a).find("#widget_selector");t.on("mouseup",function(){var t=e(this);if("disabled"!=t.val()&&void 0!=t.val()){d();var i={action:"cherry_mega_menu_add_widget",id_base:t.val(),menu_item_id:n.settings.menu_item_id,total_cols:n.settings.cols,title:t.find("option:selected").text(),_wpnonce:cherry_mega_menu.nonce};e.post(ajaxurl,i,function(t){m(),e(".no_widgets").hide(),e("#widgets").append(t.content),u(),(t.type="success")&&p(e("#"+a+" #"+t.id))})}})},p=function(t){var i=t.find(".spinner"),a=t.find(".widget-resize"),o=t.find(".widget-edit"),c=t.find(".widget-inner"),s=t.attr("data-widget-id");return t.bind("on_drop",function(){d();var t=e(this).index();e.post(ajaxurl,{action:"cherry_mega_menu_move_widget",widget_id:s,position:t,menu_item_id:n.settings.menu_item_id,_wpnonce:cherry_mega_menu.nonce},function(e){m(),n.log(e)})}),a.on("click",function(){var i=parseInt(t.attr("data-columns"),10),a=e(this).data("action");"expand"==a&&i<n.settings.cols&&(i+=1,t.attr("data-columns",i)),"contract"==a&&i>0&&(i-=1,t.attr("data-columns",i)),t.find(".widget-cols-counter b").html(i),d(),e.post(ajaxurl,{action:"cherry_mega_menu_update_columns",widget_id:s,columns:i,_wpnonce:cherry_mega_menu.nonce},function(e){m(),n.log(e)})}),o.on("click",function(){t.hasClass("open")||t.data("loaded")?t.toggleClass("open"):(i.show(),e.post(ajaxurl,{action:"cherry_mega_menu_edit_widget",widget_id:s,_wpnonce:cherry_mega_menu.nonce},function(a){var o=e(a);e(".delete",o).on("click",function(i){i.preventDefault();var a={action:"cherry_mega_menu_delete_widget",widget_id:s,_wpnonce:cherry_mega_menu.nonce};e.post(ajaxurl,a,function(e){t.remove(),n.log(e)})}),e(".close",o).on("click",function(e){e.preventDefault(),t.toggleClass("open")}),o.on("submit",function(t){t.preventDefault();var i=e(this).serialize();d(),e.post(ajaxurl,i,function(e){m(),n.log(e)})}),c.html(o),t.data("loaded",!0).toggleClass("open"),i.hide()})),e(".widget").not(t).removeClass("open")}),t};n.init()}}(jQuery),jQuery(function(e){e("#menu-management").on("hover, touchEnd, MSPointerUp, pointerup",".menu-item:not(.cherry-mega-menu-processed)",function(){var t=e(this),n=t.find(".menu-item-title").html(),i=parseInt(t.attr("id").match(/[0-9]+/)[0],10),a=e("<span>").addClass("cherry-mega-menu-launch").attr({"data-id":i,"data-title":n});t.addClass("cherry-mega-menu-processed"),e(".item-title",t).append(a),a.html(cherry_mega_menu.launch_popup).on("click",function(a){a.preventDefault();var o=t.attr("class").match(/\menu-item-depth-(\d+)\b/)[1];e(this).megaMenu({cols:cherry_mega_menu.cols,menu_item_id:i,menu_item_title:n,menu_item_depth:o})})})});